== Using data binding in Android applications

=== Introduction to data binding in Android

Android offers support to write declarative layouts using data binding.
This minimizes the necessary code in your application logic to connect to the user interface elements.

image::db_android10.png[]
		
To enable the usage of data binding in your Android application, add the following snippet to the app/build.gradle file.
			
[source,gradle]
----
android {
    ....
    dataBinding {
        enabled = true
    }
}
----

To use data binding you have to add information to your layout files.
Layout files which supports data binding start with a `layout` root tag followed by a `data` element and a `view` root element. 
This `view` element contains the standard layout information.
Without data binding that would be the root of your layout file. 

During the build process this addition layout information is read and `Binding` classes are generated based on its information.
The generated name of the `Binding` class is based on the name of the layout file. 
It converts the name to Pascal case and adds the “Binding” suffix to it. 
For example, if the layout file is called `activity_main.xml`, the generate class is called `ActivityMainBinding`. 

[source,xml]
----
 ActivityMainBinding binding = DataBindingUtil.setContentView(this, R.layout.activity_main);
----

You can also inflate layouts for `RecyclerView`, `ViewPager`, or other things that aren’t setting the Activity contents.


[source,xml]
----
ActivityMainBinding binding = ActivityMainBinding.inflate(getLayoutInflater(), container, attachToContainer);
// get the root view
View view = binding.getRoot();
----


This class holds all the bindings from the layout properties, i.e., the defined variable to the corresponding views. 
It also knows how to assign values for the binding expressions.

		
The data elements describe data which is available for binding.
Expressions within the layout are written in the attribute properties using the “@{}” syntax.
		
A sample file looks like the following listing.
		
[source,xml]
----
include::res/main_layout.xml[]
----
		
The user variable within data describes a property that may be used within this layout.

=== Data binding for events
		
Events may be bound to handler methods directly, similar to the way `android:onClick` can be assigned to a method in the activity. 
Event attribute names are governed by the name of the listener method with a few exceptions. 
For example, `View.OnLongClickListener` has a `method onLongClick()`, so the attribute for this event is `android:onLongClick`.
		
To assign an event to its handler, use a normal binding expression, with the value being the method name to call. 
The binding expression can assign the click listener for a View.

=== Updating the user interfaces with changes from the data model

Any plain old Java object (POJO) can be used for data binding.
But to update the UI if the data object change, these objects must be able to notify about data changes. 
There are three different data change notification mechanisms:
* Observable objects
* observable fields
* observable collections

Android provides the `BaseObservable` class which you can extend.
The data class is responsible for notifying when the properties change. 
This is done by assigning a `@Bindable` annotation to the getter and notifying in the setter.

[source,java]
----
package com.vogella.android.databinding;


import android.databinding.BaseObservable;
import android.databinding.Bindable;

import java.util.Observable;

public class TemperatureData extends BaseObservable {
    private String celsius;

    public TemperatureData(String celsius) {
        this.celsius = celsius;
    }

    @Bindable	 	                     <1> 
    public String getCelsius() {
        return celsius;
    }

    public void setCelsius(String celsius) {
        this.celsius = celsius;
        notifyPropertyChanged(BR.celsius);         <2> 
    }
}
----

<1> Define a relevant getter
<2> Notify any listeners, BR.celsius is a generated class


This listener is invoked on every update and it updates the corresponding views. 
This ensures that updates in the model updates also the UI.
				

=== Example for using data binding
	
A sample file looks like the following listing.

[source,gradle]
----
include::res/main_layout.xml[]
----
	
The user variable within data describes a property that may be used within this layout.

The data object used with this layout may look like the following listing.

	
[source,java]
----
include::res/User.java[]
----
	
[source,java]
----
include::res/usage.java[]
----	


